{% comment %}
  Find related posts by matching tags, fallback to recent posts
{% endcomment %}
{% assign related_posts = "" | split: "" %}
{% assign max_related = 3 %}

{% if page.tags.size > 0 %}
  {% for post in site.posts %}
    {% if post.url != page.url and related_posts.size < max_related %}
      {% for tag in page.tags %}
        {% if post.tags contains tag %}
          {% assign related_posts = related_posts | push: post %}
          {% break %}
        {% endif %}
      {% endfor %}
    {% endif %}
  {% endfor %}
{% endif %}

{% comment %}
  Fill remaining slots with recent posts if needed
{% endcomment %}
{% if related_posts.size < max_related %}
  {% for post in site.posts limit:6 %}
    {% if post.url != page.url and related_posts.size < max_related %}
      {% unless related_posts contains post %}
        {% assign related_posts = related_posts | push: post %}
      {% endunless %}
    {% endif %}
  {% endfor %}
{% endif %}

{% if related_posts.size > 0 %}
<nav class="" aria-label="Related articles">
  <h2 class="text-2xl font-semibold tracking-tight mb-6">Related Articles</h2>
  <div class="grid gap-4 sm:grid-cols-3">
    {% for post in related_posts %}

    <a href="{{ post.url | relative_url }}" class="card hover:shadow-lg transition-shadow">
      <header>
        <h3 class="font-semibold mb-2 line-clamp-2">{{ post.title }}</h3>
        <p class="text-sm text-muted-foreground line-clamp-2">{{ post.description | default: post.excerpt | strip_html | truncate: 100 }}</p>
      </header>
      <footer>
        <time class="badge">{{ post.date | date: "%b %d, %Y" }}</time>
      </footer>
    </a>

    {% endfor %}
  </div>
</nav>
{% endif %}

<div class="card mt-4 text-center">
  <header>
    <h2>Thanks for reading</h2>
    <p>You can follow me here for my latest thoughts and projects</p>
  </header>
  <footer class="flex justify-center items-center gap-3.5">
    <a href="https://github.com/spencerldixon" target="_blank" rel="noopener" aria-label="GitHub">
      <i class="fa-brands fa-github fa-lg"></i>
    </a>

    <a href="https://bsky.app/profile/spencerldixon.bsky.social" target="_blank" rel="noopener" aria-label="Bluesky">
      <i class="fa-brands fa-bluesky fa-lg"></i>
    </a>

    <a href="https://twitter.com/spencerldixon" target="_blank" rel="noopener" aria-label="Twitter">
      <i class="fa-brands fa-x-twitter fa-lg"></i>
    </a>

    <a href="https://linkedin.com/in/spencerldixon" target="_blank" rel="noopener" aria-label="LinkedIn">
      <i class="fa-brands fa-linkedin fa-lg"></i>
    </a>

    <a href="javascript:window.location.href='mailto:' + atob('c3BlbmNlcmxsb3lkZGl4b25AZ21haWwuY29t')" rel="nofollow" aria-label="Email">
      <i class="fa-solid fa-envelope fa-lg"></i>
    </a>

    <a href="{{ site.url }}{{ site.baseurl }}/feed.xml" aria-label="RSS Feed">
      <i class="fa-solid fa-rss fa-lg"></i>
    </a>
  </footer>
</div>
